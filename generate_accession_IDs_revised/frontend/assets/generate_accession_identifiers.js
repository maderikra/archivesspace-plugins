var originalnumber = '';

$(function () {

  var padding = 4;

  var pad_number = function (number, padding) {
    var s = ('' + number);

    var padding_needed = (padding - s.length)

    if (padding_needed > 0) {
      s = (new Array(padding_needed + 1).join("0") + s);
    }

    return s;
  };


  var generate_accession_id = function () {	
    $.ajax({
      url: APP_PATH + "plugins/generate_accession_identifier/generate",
      data: {},
      type: "POST",
      success: function(identifier) {
        $('#accession_id_0_').val(identifier.year + '.' + pad_number(identifier.number, padding));
//stores the autogenerated value to be checked against the submitted value later, to see if it was altered
        originalnumber = identifier.year + '.' + pad_number(identifier.number, padding);

      },
    })
  };


  var identifier_is_blank = function () {
    for (var i = 0; i < 4; i++) {
      if ($("#accession_id_" + i + "_").val() !== "") {
        return false;
      }
    }

    return true;
  };



  if (identifier_is_blank()) {
    generate_accession_id();
  }

})

$( document ).ready(function() {

	$( "button[type='submit']" ).on("click", function(event){
//sets current accession number as variable to compare against original
var newnumber = $('#accession_id_0_').val(); 

if (newnumber == originalnumber){
//stops form from being submitted until the new accession number is added to the mysql db
	event.preventDefault();
//calls action  ("generate2") that will write new number to db
  $.ajax({
      url: APP_PATH + "plugins/generate_accession_identifier/generate2",
      data: {},
      type: "POST",
      success: function(identifier) {
//actually submits the form once the new accession number has been added to the sequence       
 $('#accession_form').submit();
      },
    })
}
    });

});
